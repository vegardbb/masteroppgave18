\begin{lstlisting}[language=Java, caption={Dynamisk metode i Migrator som kjøres i separat tråd.}]
// Addition of transformer class to the HashMap
private void addTransformer(AbstractAggregateTransformer t) { this.transformers.put(t.getAppVersion(), t); }

// Separate process that actively listens for new classes that extend AAT
private void aggregateTransformerReceiver() {
    // Define ClassLoader instance
    AggregateTransformerLoader loader = new AggregateTransformerLoader();
    while ( this.transformers.size() < 1 ) {
        try {
            Path path = Paths.get( new URI("./classes/" + this.className + ".class"));
            // Use Files.exists - condition
            if (Files.exists(path)) {
                byte[] classData = Files.readAllBytes(path);
                Class<?> c = loader.createClass(this.className, classData);
                Constructor cons = c.getConstructor(String.class, String.class);
                AbstractAggregateTransformer tran = (AbstractAggregateTransformer) cons.newInstance( "x", "y" );
                // What to do with the transformer object: Add it to the AAT list
                this.addTransformer(tran);
            }
        } catch (Exception e) {
            logger.error("An error occurred in AggregateTransformerReceiver ", e);
        }
    }
}
\end{lstlisting}
