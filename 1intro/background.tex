\section{Bakgrunn} \label{1dot1}

% Tilgjengelighet er et svært viktig attributt i e-kommers-industrien
Moderne nettbutikker, offentlige nettbaserte tjenester, og nettbankapplikasjoner stilles svært strenge krav til tilgjengelighet. Aller helst skal en hvilken som helst kunde av en populær nettbutikk som Amazon kunne se på og legge ting i handlekurven, for deretter å betale for dem \textbf{når som helst, til alle døgnets tider}. At en vare blir lagt i handlekurven to ganger eller at en kunde leser utdatert informasjon om en vare like etter at den er blitt oppdatert har ikke så mye å si, for den slags småfeil lar seg alltid rette opp i ettertid.

I tjenestenivåavtalen \footnote{Tilgjengelig på url \url{https://aws.amazon.com/ec2/sla/}} (eng. ''Service Level Agreement'') til Amazon EC2 oppgis en tilgjengelighetsgaranti på 99,95 prosent \citep{BCK2013}. Til tross for denne høye prosenten, må programvarearkitekter som vil gjeste sine systemer på EC2 ta høyde for den halve prosentandelen, der plattformen ikke er tilgjengelig for tjenesteleveranse.

% Sammenheng mellom tilgjengelighet og nedetid.
Hvert sekund nedetid teller når det kommer til høyt trafikkerte tjenester på Internett som det sosiale mediet Facebook og tidligere nevnte Amazon sine skytjenester. Den 21. april 2011 hadde skyplattformen Amazon EC2 en periode med nedetid på fire dager \citep{BCK2013}. Dette tjenesteavbruddet rammet mange oppstartsselskaper som benyttet skyplattformen, inklusive Reddit, Quora og FourSquare. \cite{Schiller2011} ved Information Today rapporterer at årsaken til hendelsen kom av en planlagt konfigurasjonsoppdatering som medførte at mange tjenestenoder mistet kontakten med backuptjenerne. Den samlede effekten av at alle nodene automatisk prøvde å gjenetablere forbindelsen, førte til en overbelastning av forespørsler mot disse tjenerne.

En interressant bemerkning fra denne episoden er at Netflix også var en hyppig bruker av plattformen på det tidspunktet webtjenesten gikk ned, uten at det gikk utover strømme - tjenestens egen tilgjengelighet. Forklaringen var at Netflix sine ingeniører tok høyde for den halve promillen som EC2 sin tjenestegaranti ikke dekket, blant annet ved å spre flere instanser av sine tilstandsløse tjenester utover flere av Amazon sine tilgjengelighetssoner \citep{BCK2013}.

% Nedetid i forhold til kvaliteten på tilgjengelighet
Nedetid, den forventede tiden en plattform eller et programvaresystem ikke kan utføre dets definerte arbeidsoppgaver for dets brukere i løpet av en definert tidsperiode, er sterkt knyttet til systemets tjenestenivågaranti. Slike tilgjengelighetsgarantier baseres på beregninger med stokastiske modeller, for eksempel Markoff-analyse eller feil-tre \citep{BCK2013}. Ved hjelp av nevnte verktøy kan man anslå en forventningsverdi for hvor lang tid det vil gå mellom hvert feilscenario som rammer systemet, slik at det blir totalt utilgjengelig for bruk. For å estimere denne verdien måles tiden fra en programvareinstans slås av til en ny startes opp, for eksempel ved en programvareoppdatering.

Alternativt kan man estimere en forventningsverdi for hvor lang tid det tar å reparere eller maskere nevnte feil, slik at tjenester kan leveres av systemet som normalt. For å estimere denne forventningsverdien måles hvor lang tid en programvareoppdatering tar.

% Hva forårsaker nedetid?
Ut ifra en studie av flere dusin feilscenarier i storskala internettsystemer gjorde \cite{oppenheimer2003internet} følgende konkluderende observasjoner: (1) operatørfeil er den hovedsaklige feilkilden i to av tre tilfeller; (2) operatørfeil har størst innvirkning på reparasjonstiden i to av tre internett-tjenester; (3) blant operatørfeil er konfigurasjonsfeil (feil syntaks, inkompatible argumenter) vanligst.

I en annen undersøkelse, der totalt 51 databaseadministratorer med varierende fartstid i yrket ble intervjuet, identifiserer \cite{oliveira2006understanding} i alt åtte kategorier feilscenarier som oppstår i et databasesystem som kjører i et produksjonsmiljø: leveranse til produksjonsmiljø (deployment), ytelse (performance), strukturer i databasen (structure), tilgangsrettigheter (''access-privilege''), vedlikehold (maintenance), diskplass (space), feil i programvare (DBMS), og feil i maskinvare (hardware). I de fem førstnevnte er det databaseadministratoren som er den typiske feilkilden (i over 50 prosent av problemene som ble oppgitt under intervjuene) til at disse feiltypene oppstår. %e

% Om online oppgradering
Observerte trender innen flere forskjellige typer næringsvirksomhet, deriblant kundestøtte, industriell produksjon, e-kommers, finans, og banktjenester \citep{dumitras2010upgrade, choi2009} tilsier at det er et sterkt behov for distribuerte systemarkitekturer som støtter online-oppgraderinger. Oppgraderingsrutiner for kjørende databaseapplikasjoner som fordrer eller påtvinger nedetid, er ikke lengre forsvarlige i lys av tjenestenivåavtalene som deres flerfoldige tusen klienter tilbys.

Den mest sentrale karakteristikken ved programvareoppgradering uten stopp i systemet, er at den gamle versjonen av applikasjonen må kjøre samtidig som den nye installeres, slik at tjenestene applikasjonen leverer ikke blir utilgjengelig for dets brukere. \cite{choi2009} kaller denne rutinen for ''hot rollover''. I tillegg må installasjonen ikke forstyrre applikasjonens leveranse av tjenester, e.g. behandling av innkommende HTTP-forespørsler.

Kunsten å holde styr på tredjeparts pakker som en programvaremodul er avhengig av, er et annet sentralt problem relatert til levende programvareoppgradering. En modul er avhengig av en pakke hvis den kaller på funksjoner fra pakken. Dette må gjøres for å oppdage om den gamle og nye versjonen har delte avhengigheter, det vil si at begge versjoner avhenger av samme programvarepakke, men ikke nødvendigvis samme versjon av denne pakken.  For at tjeneren skal unngå å miste data eller å gå ned, må begge versjonene av en og samme pakke installeres på tjeneren. I praksis benytter oppdateringsprogrammet som håndterer avhengigheter, en form for manuelt skrevet konfigurasjonsfil der alle avhengigheter listes i form av par av unike pakkenavn og påkrevd versjon. For eksempel leser pakkehåndtereren til NodeJS inn avhengigheter fra en JSON-fil med navn ''packages.json'', som vedlikeholdes av utviklerne selv. %e

Disse inputfilene er altså kilder til menneskelige feil, som for eksempel syntaksfeil, eller deprekeringsadvarsler. Det er bevist at problemet med å løse opp avhengigheter er NP-hardt ved å utføre en reduksjon (transformering av problemet og dets input) fra \textbf{3SAT} -- problemet \citep{dumitracs2009upgrades}. Dermed er det grenser for hvor mange og store avhengigheter et programvaresystem kan ha før kjøretidskostnaden for avhengighetsbehandling (i for eksempel APT-registeret) vokser seg altfor stor. %e

Derfor har store aktører i industrien i de senere år innført prossessen \emph{rullerende oppgradering}, der programvaren på én etter én tjener i klyngen av tjenere blir oppdatert. Ved en automatisert, rullerende oppgradering kan man i utgangspunktet kun gjennomføre patching av programvare, det vil si at brukergrensesnittet som applikasjonen tjener, må i den nye versjonen være bakoverkompatibel med den gamle. Eventuelle konflikter må løses manuelt. % bryt-opp

Opp igjennom det siste tiåret har det vært vanlig å oppgradere programvare som kjører i et system av flere instanser, eller prosesser, på rullerende vis. I denne manuelt kontrollerte oppgraderingsmetoden blir én etter én instans av den gamle versjonen av programmet avsluttet og erstattet med en instans av den nye versjonen. Et vesentlig problem med denne metoden er at applikasjonens datamodell som regel er realisert i et databasesystem som er instansiert i en separat prosess fra webapplikasjonsprosessen på en og samme fysiske tjenerdatamaskin. Dermed oppgraderes datamodellen til hver applikasjonsinstans på et annet tidspunkt enn koden til selve applikasjonen. Dette medfører at det distribuerte produksjonsmiljøet befinner seg i en blandet tilstand. Da kan en uoppgradert, kjørende webapplikasjon potensielt interagere med en oppgradert datamodell og vice versa. Denne kommunikasjonen kan introdusere uante feilkilder til applikasjonen. % bryt-opp
